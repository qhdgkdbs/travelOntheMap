<!DOCTYPE html>
<html>
<head>
    <meta charset="UTF-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, minimum-scale=1.0, user-scalable=no">
    <title>여행을 가고 싶어서 만드는 중</title>
    <link rel = "stylesheet" href="/stylesheets/style.css">
    <script type="text/javascript" src="https://openapi.map.naver.com/openapi/v3/maps.js?ncpClientId=9mlra4rwwq"></script>
</head>
<body>
  <div id="navbar">지도위에<br>여미치</div>
  <div id="infoBox">
    <div id="infoTitle">사용방법</div>
    <div id="infoContent">모든 정보는</div>
  </div>
  <div id="map" style="width:100%;height:100vh;"></div>
  <script type="text/javascript" src="/data/data.js"></script>
  <script>
  var mapOptions = {
      center: new naver.maps.LatLng(37.531471, 126.979514),
      zoom: 10
  };

  var map = new naver.maps.Map('map', mapOptions);
  
  var markerList = [];
  var infowindowList = [];

  for(var i in data){
    var target = data[i]
    var latlng = new naver.maps.LatLng(target.lat, target.lng) //위도 경도
    marker = new naver.maps.Marker({
      map : map,
      position : latlng,
      icon : {
        // content : "<div class='marker'></div>",
        url:'/images/icon.png',
        size: new naver.maps.Size(40, 40),
        origin: new naver.maps.Point(0, 0),
        anchor : new naver.maps.Point(16,20) // 중심 좌표를 변경해주는 것
      }
    })

    var content = `<div class='infowindow_wraps'>
        <div class="infoImg"><img src="${target.img}" width=150 hdight=150></div>
        <div class='infowindow_title'>${target.title}</div>
        <div class='infowindow_content'>${target.content}</div>
        <div class='infowindow_date'>${target.date}</div>
      </div>` // ${}이런식으로 변수선언이 가능함, string을 담는 값
      

    var infowindow = new naver.maps.InfoWindow({
      content : content,
      backgroundColor : "#00ff0000",
      borderColor : "#00ff0000",
      anchorSize : new naver.maps.Size(12,12)
    })

    markerList.push(marker);
    infowindowList.push(infowindow);
  }


  for(var i = 0,ii = markerList.length; i < ii; i++){
    naver.maps.Event.addListener(map, "click", clickMap(i));
    naver.maps.Event.addListener(markerList[i], "click", getClickHandler(i));
  }

  function clickMap(i) {
    return function(){
      var infowindow = infowindowList[i]
      infowindow.close()
    }
  }

  function getClickHandler(i) {
    return function(){
      var marker = markerList[i];
      var infowindow = infowindowList[i];
      if(infowindow.getMap()){
        infowindow.close();
      }else{
        infowindow.open(map, marker)
      }
    }
  }


  // maker = new naver.maps.Marker({
  //   map : map,
  //   position : new naver.maps.LatLng(37.3595704, 127.105399),
  //   icon : {
  //     content : "<div class='marker'></div>"
  //   }
  // })
  </script>
</body>
</html>