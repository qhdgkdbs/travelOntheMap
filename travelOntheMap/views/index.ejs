<!DOCTYPE html>
<html>
<head>
    <meta charset="UTF-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, minimum-scale=1.0, user-scalable=no">
    <title>ì—¬í–‰ì„ ê°€ê³  ì‹¶ì–´ì„œ ë§Œë“œëŠ” ì¤‘</title>
    <script src="https://code.jquery.com/jquery-1.12.4.min.js" integrity="sha256-ZosEbRLbNQzLpnKIkEdrPv7lOy9C27hHQ+Xp8a4MxAQ=" crossorigin="anonymous"></script>
    <link rel = "stylesheet" href="/stylesheets/style.css">
    <script type="text/javascript" src="https://openapi.map.naver.com/openapi/v3/maps.js?ncpClientId=9mlra4rwwq"></script>
    <script type="text/javascript" src="/src/MarkerClustering.js"></script>
</head>
<body>
  <div id="navbar">ì§€ë„ìœ„ì—<br>ì—¬ë¯¸ì¹˜</div>
  <div id="infoBox">
    <div id="infoTitle">ì‚¬ìš©ë°©ë²•</div>
    <div id="infoContent">ëª¨ë“  ì •ë³´ëŠ”</div>
  </div>
  <div id="map" style="width:100%;height:100vh;"></div>
  <script type="text/javascript" src="/data/data.js"></script>
  <script>

  var mapOptions = {
      center: new naver.maps.LatLng(37.531471, 126.979514),
      zoom: 10
  };

  var map = new naver.maps.Map('map', mapOptions);
  
  var markerList = [];
  var infowindowList = [];

  for(var i in data){
    var target = data[i]
    var latlng = new naver.maps.LatLng(target.lat, target.lng) //ìœ„ë„ ê²½ë„
    marker = new naver.maps.Marker({
      map : map,
      position : latlng,
      icon : {
        // content : "<div class='marker'></div>",
        url:'/images/icon.png',
        size: new naver.maps.Size(40, 40),
        origin: new naver.maps.Point(0, 0),
        anchor : new naver.maps.Point(16,20) // ì¤‘ì‹¬ ì¢Œí‘œë¥¼ ë³€ê²½í•´ì£¼ëŠ” ê²ƒ
      }
    })
    

    var content = `<div class='infowindow_wraps'>
        <div class="infoImg"><img src="${target.img}" width=200 hdight=200></div>
        <div class="infowindow_text">
          <div class='infowindow_title'>${target.title}</div>
          <div class='infowindow_content'>ğŸ‘‰ ${target.content}</div>
          <div class='infowindow_more'>
            <a href="${target.more}" title="ì¸ìŠ¤íƒ€ê·¸ë¨ì—ì„œ ë” í™•ì¸í•˜ê¸°" target="_blank">
              <div class='infowindow_more_icon'>
                <img src="/images/more_icon.png" width=32 hdight=32>
              </div>
            </a>
            </div>
        </div>
      </div>` // ${}ì´ëŸ°ì‹ìœ¼ë¡œ ë³€ìˆ˜ì„ ì–¸ì´ ê°€ëŠ¥í•¨, stringì„ ë‹´ëŠ” ê°’
      

    var infowindow = new naver.maps.InfoWindow({
      content : content,
      backgroundColor : "#00ff0000",
      borderColor : "#00ff0000",
      anchorSize : new naver.maps.Size(12,12)
    })

    markerList.push(marker);
    infowindowList.push(infowindow);
  }


  for(var i = 0,ii = markerList.length; i < ii; i++){
    naver.maps.Event.addListener(map, "click", clickMap(i));
    naver.maps.Event.addListener(markerList[i], "click", getClickHandler(i));
  }

  var htmlMarker1 = {
            content: '<div style="cursor:pointer;width:40px;height:40px;line-height:42px;font-size:10px;color:white;text-align:center;font-weight:bold;background:url(/images/cluster-marker-1.png);background-size:contain;"></div>',
            size: N.Size(40, 40),
            anchor: N.Point(20, 20)
        },
        htmlMarker2 = {
            content: '<div style="cursor:pointer;width:40px;height:40px;line-height:42px;font-size:10px;color:white;text-align:center;font-weight:bold;background:url(/images/cluster-marker-2.png);background-size:contain;"></div>',
            size: N.Size(40, 40),
            anchor: N.Point(20, 20)
        },
        htmlMarker3 = {
            content: '<div style="cursor:pointer;width:40px;height:40px;line-height:42px;font-size:10px;color:white;text-align:center;font-weight:bold;background:url(/images/cluster-marker-3.png);background-size:contain;"></div>',
            size: N.Size(40, 40),
            anchor: N.Point(20, 20)
        },
        htmlMarker4 = {
            content: '<div style="cursor:pointer;width:40px;height:40px;line-height:42px;font-size:10px;color:white;text-align:center;font-weight:bold;background:url(/images/cluster-marker-4.png);background-size:contain;"></div>',
            size: N.Size(40, 40),
            anchor: N.Point(20, 20)
        },
        htmlMarker5 = {
            content: '<div style="cursor:pointer;width:40px;height:40px;line-height:42px;font-size:10px;color:white;text-align:center;font-weight:bold;background:url(/images/cluster-marker-5.png);background-size:contain;"></div>',
            size: N.Size(40, 40),
            anchor: N.Point(20, 20)
        };

    var markerClustering = new MarkerClustering({
        minClusterSize: 4,
        maxZoom: 13,
        map: map,
        markers: markerList,
        disableClickZoom: false,
        gridSize: 120,
        icons: [htmlMarker1, htmlMarker2, htmlMarker3, htmlMarker4, htmlMarker5],
        indexGenerator: function(count) {
            var index = 0;

            if (count >= 10 && count < 20) {
                index = 1;
            } else if (count >= 20 && count < 50) {
                index = 2;
            } else if (count >= 50 && count < 100) {
                index = 3;
            } else if (count >= 100) {
                index = 4;
            }

            return index;
        },
        stylingFunction: function(clusterMarker, count) {
            $(clusterMarker.getElement()).find('div:first-child').text(count);
        }
    });

    
  function clickMap(i) {
    return function(){
      var infowindow = infowindowList[i]
      infowindow.close()
    }
  }

  function getClickHandler(i) {
    return function(){
      var marker = markerList[i];
      var infowindow = infowindowList[i];
      if(infowindow.getMap()){
        infowindow.close();
      }else{
        infowindow.open(map, marker)
      }
    }
  }


  // maker = new naver.maps.Marker({
  //   map : map,
  //   position : new naver.maps.LatLng(37.3595704, 127.105399),
  //   icon : {
  //     content : "<div class='marker'></div>"
  //   }
  // })


  </script>
</body>
</html>